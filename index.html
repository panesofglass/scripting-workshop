<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>The Agony and the Ecstasy of F# Scripting</title>
    <meta name="description" content="Discover the wonderful world of F# scripting, including its agonies and ecstasies. We'll work through building a simple application starting with a script and moving to the relevant library and test projects and discuss strategies for managing app settings and connection strings, as well as how to access command line arguments.">
    <meta name="author" content="Ryan Riley">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="//code.jquery.com/jquery-1.8.0.js"></script>
    <script src="//code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/night.css" id="theme">
    <link type="text/css" rel="stylesheet" href="fsharp.formatting/styles/style.css" />
    <link type="text/css" rel="stylesheet" href="fsharp.formatting/styles/deedle.css" />
    <link type="text/css" rel="stylesheet" href="css/custom.css" />
    <script src="fsharp.formatting/styles/tips.js" type="text/javascript"></script>
    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">
    <link rel="stylesheet" href="css/fsreveal.css">
    <!-- If the query includes 'print-pdf', include the PDF print sheet -->
    <script>
			if( window.location.search.match( /print-pdf/gi ) ) {
				var link = document.createElement( 'link' );
				link.rel = 'stylesheet';
				link.type = 'text/css';
				link.href = 'css/print/pdf.css';
				document.getElementsByTagName( 'head' )[0].appendChild( link );
			}
    </script>
    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
    <script language="javascript" type="text/javascript">
        function init()
        {
            websocket = new WebSocket("ws://"+window.location.host+"/websocket");
            websocket.onmessage = function(evt) { location.reload(); };
        }
        window.addEventListener("load", init, false);
    </script>
</head>
<body>
    <div class="reveal">
        
        <!-- Any section element inside of this container is displayed as a slide -->
        <div class="slides">
            <section >
<h2>The Agony and the Ecstasy of F# Scripting</h2>
<p><a href="https://emerdelac.files.wordpress.com/2012/05/the-agony-and-the-ecstasy.jpg"><img src="images/the-agony-and-the-ecstasy.jpg" alt="The Agony and the Ecstasy" /></a></p>
<aside class="notes">
Welcome to The Agony and the Ecstasy of F# Scripting workshop.<br/>
This workshop targets beginners but should be informative to those<br/>
with more experience.<br/>
I chose the title based on the movie of a similar name. Are any of you<br/>
familiar with it? The Agony and the Ecstasy covers Michelangelo's painting<br/>
the Cistene Chapel, a beautiful work of art. Scripting can feel like a<br/>
beautful work of art, and it offers a terrific workflow for building programs.<br/>
However it comes with its own, unique set of challenges, and scripts<br/>
have a tendency to fall behind and then get discarded, especially when<br/>
they present frustrating errors.<br/>
</aside>
</section>
<section >
<section >
<h2>Overview</h2>
<aside class="notes">
The goal for this workshop is for you to learn how to leverage F#'s<br/>
scripting capabilities. F# scripting is incredibly useful; however,<br/>
it has some frustrating rough edges.<br/>
In this workshop, we will build a simple ETL application. Along the<br/>
way, I'll highlight the challenging areas and provide solutions for<br/>
overcoming them.<br/>
Show the completed script running.<br/>
</aside>
</section>
<section >
<h3>ETL Applications</h3>
<aside class="notes">
You may wonder why I would choose an ETL application as a workshop<br/>
project. It's a good question. It's exciting to build web server<br/>
applications, especially those with beautiful front-end UIs.<br/>
However, we have a limited time, and in doing this, we would not<br/>
have time enough to cover as many issues peculiar to scripting.<br/>
ETL programs are simple, highlight some of the benefits of using<br/>
F# practically, provide a way of introducing F# into any work<br/>
environment, and lend themselves well to scripting. If you are<br/>
currently using SSIS for ETL projects, you may find an F# replacement<br/>
makes it much easier to parallelize, debug, and deploy.<br/>
</aside>
</section>
</section>
<section >
<section >
<h2>What's not covered?</h2>
<aside class="notes">
We won't have time to cover every aspect of scripting in our two hour<br/>
workshop today. <br/>
</aside>
</section>
<section >
<h3>Working with Databases</h3>
<aside class="notes">
We'll be covering data access, but we won't be covering SQL databases<br/>
in particular. While this is a very common use case, it often requires<br/>
more setup time than we have available.<br/>
However, we will cover accessing config files, which are typically one<br/>
of the more challenging areas of working with databases from scripts.<br/>
</aside>
</section>
<section >
<h3>Fable</h3>
<aside class="notes">
Fable, the F# to JavaScript compiler, is definitely worth your time<br/>
to investigate and expands the possiblities of F# scripting since it<br/>
opens F# to the entire JavaScript ecosystem.<br/>
</aside>
</section>
<section >
<h3>Notebooks</h3>
<aside class="notes">
Jupyter Notebooks, available both locally and in Azure, provide a<br/>
fantastic opportunity for leveraging scripts. The F# integration<br/>
provides several helpers to alleviate some of the pain points<br/>
we'll work through today.<br/>
</aside>
</section>
<section >
<h3>Azure Functions, AWS Lambda, etc.</h3>
<aside class="notes">
One reason to learn more about F# scripts is to leverage them as<br/>
deployable applications in services like Azure Functions, AWS Lambda,<br/>
etc.<br/>
All of these are fantastic topics, and if time permits, we will look<br/>
through a few examples.<br/>
</aside>
</section>
</section>
<section >
<h2>What we will cover</h2>
<ul>
<li>Creating and running scripts</li>
<li>Iterating design</li>
<li>Loading and referencing files</li>
<li>Referencing NuGet packages</li>
<li>Accessing values from .config files</li>
<li>Working with data</li>
<li>Leveraging scripts for <acronym title="Extract-Transform-Load">ETL</acronym></li>
<li>Testing</li>
<li>Visualizing data sets</li>
<li>Accessing command line parameters</li>
<li>Using scripts in a project</li>
<li>Debugging scripts</li>
<li>Build and deploy scripting with FAKE</li>
</ul>
</section>
<section >
<section >
<h2>Getting Started</h2>
<p><a href="https://github.com/panesofglass/scripting-workshop">https://github.com/panesofglass/scripting-workshop</a></p>
<aside class="notes">
Please go to GitHub and pull down the scripting-workshop repository.<br/>
In order to begin, you must have F# installed. I assume you have installed<br/>
it already, but if not, please go to http://fsharp.org/ to find the instructions<br/>
for your environment, or ask for help as we begin the first exercise.<br/>
F# Interactive can be run from the command line or from several IDEs and<br/>
text editors. To begin, please find the correct command line executable<br/>
for your environment. We are going to start simply using the CLI tool for now.<br/>
</aside>
</section>
<section >
<h3>Scripting Workshop</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="o">/</span><span class="i">scripting</span><span class="o">-</span><span class="i">workshop</span>
  <span class="o">/.</span><span class="i">paket</span>        <span class="o">&lt;-</span> <span class="i">Paket</span> <span class="i">related</span>
  <span class="o">/</span><span class="i">completed</span>     <span class="o">&lt;-</span> <span class="k">in</span> <span class="i">case</span> <span class="i">you</span> <span class="i">get</span> <span class="i">stuck</span>
  <span class="o">/</span><span class="i">exercises</span>     <span class="o">&lt;-</span> <span class="i">working</span> <span class="i">directory</span>
  <span class="o">/</span><span class="i">slides</span>        <span class="o">&lt;-</span> <span class="i">ignore</span>
  <span class="o">-</span> <span class="i">paket</span><span class="o">.</span><span class="i">dependencies</span>
  <span class="o">-</span> <span class="i">paket</span><span class="o">.</span><span class="i">lock</span>
  <span class="o">-</span> <span class="o">..</span><span class="o">.</span> <span class="i">other</span> <span class="i">files</span> 
</code></pre></td>
</tr>
</table>
</section>
<section >
<h3>Finding FSI on Windows</h3>
<p><code>C:\Program Files (x86)\Microsoft SDKs\F#\4.1\Framework\v4.0\fsiAnyCPU.exe</code></p>
<aside class="notes">
F# Interactive is hidden in the Microsoft SDKs folder on Windows and not<br/>
added to the `PATH` by default. It is worth the extra effort to add this<br/>
to your path if you use it regularly.<br/>
</aside>
</section>
<section >
<p><img src="images/agony.png" alt="agony" /></p>
</section>
<section >
<h3>Finding FSI on Mac and Linux</h3>
<p><code>fsharpi</code></p>
<aside class="notes">
Mono adds the alias `fsharpi`. If you run `which fsharpi`, you'll likely<br/>
find it is in a folder in your path, so it's readily accessible.<br/>
</aside>
</section>
<section >
<p><img src="images/ecstasy.png" alt="ecstasy" /></p>
</section>
<section >
<h3>F# Interactive in the Terminal</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">F#</span> <span class="i">Interactive</span> <span class="k">for</span> <span class="i">F#</span> <span class="n">4.1</span>
<span class="i">Freely</span> <span class="i">distributed</span> <span class="i">under</span> <span class="i">the</span> <span class="i">Apache</span> <span class="n">2.0</span> <span class="i">Open</span> <span class="i">Source</span> <span class="i">License</span>

<span class="i">For</span> <span class="i">help</span> <span class="k">type</span> #<span class="i">help</span>;;

<span class="o">&gt;</span> 
</code></pre></td>
</tr>
</table>
<aside class="notes">
Please try running the executable on your command line.<br/>
You should see a prompt. F# interactive will let you enter F# code<br/>
and run it immediately. This can be useful for very simple use cases.<br/>
</aside>
</section>
<section >
<h3>Enter <code>2 + 2;;</code></h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="o">&gt;</span> <span class="n">2</span> <span class="o">+</span> <span class="n">2</span>;;
<span class="k">val</span> <span class="i">it</span> <span class="o">:</span> <span class="i">int</span> <span class="o">=</span> <span class="n">4</span>

<span class="o">&gt;</span> 
</code></pre></td>
</tr>
</table>
<aside class="notes">
You should see the output appear immediately underneath.<br/>
The result is assigned to a value `it`, which is typed as an `int`.<br/>
Note the `;;` at the end. That tells F# Interactive that you are<br/>
done entering the expression, and you want it evaluated.<br/>
</aside>
</section>
<section >
<h3>Enter <code>it;;</code></h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="o">&gt;</span> <span class="i">it</span>;;
<span class="k">val</span> <span class="i">it</span> <span class="o">:</span> <span class="i">int</span> <span class="o">=</span> <span class="n">4</span>

<span class="o">&gt;</span> 
</code></pre></td>
</tr>
</table>
<aside class="notes">
You can get F# Interactive to repeat the value by entering `it;;`.<br/>
This is useful when working directly within the F# Interactive prompt,<br/>
as you can enter code without assigning it to a name and just use `it`<br/>
when you want to use the result.<br/>
</aside>
</section>
<section >
<h3>Enter <code>let x = it;;</code></h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="o">&gt;</span> <span class="k">let</span> <span class="i">x</span> <span class="o">=</span> <span class="i">it</span>;;
<span class="k">val</span> <span class="i">x</span> <span class="o">:</span> <span class="i">int</span> <span class="o">=</span> <span class="n">4</span>

<span class="o">&gt;</span> 
</code></pre></td>
</tr>
</table>
<aside class="notes">
You can also write assignments directly within F# Interactive. <br/>
We can assign functions in the same way.<br/>
Note that the value has been assigned to the specified name `x`,<br/>
not `it`. However, you can still access `it` as the F# Interactive<br/>
session retains everything loaded during the session until you<br/>
restart or create a new session.<br/>
</aside>
</section>
<section >
<h3>Enter <code>type MyClass() = member val Name = "" with get, set;;</code></h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="o">&gt;</span> <span class="k">type</span> <span class="i">MyClass</span>() <span class="o">=</span>                      
<span class="o">-</span>     <span class="k">member</span> <span class="k">val</span> <span class="i">Name</span> <span class="o">=</span> <span class="s">&quot;&quot;</span> <span class="k">with</span> <span class="i">get</span>, <span class="i">set</span>;;
<span class="k">type</span> <span class="i">MyClass</span> <span class="o">=</span>
  <span class="k">class</span>
    <span class="k">new</span> <span class="o">:</span> <span class="i">unit</span> <span class="k">-&gt;</span> <span class="i">MyClass</span>
    <span class="k">member</span> <span class="i">Name</span> <span class="o">:</span> <span class="i">string</span>
    <span class="k">member</span> <span class="i">Name</span> <span class="o">:</span> <span class="i">string</span> <span class="k">with</span> <span class="i">set</span>
  <span class="k">end</span>

<span class="o">&gt;</span> 
</code></pre></td>
</tr>
</table>
<aside class="notes">
We can also enter type definitions. Here I've defined a class, but this<br/>
could just as easily be a record, discriminated union, etc.<br/>
In this case, we have a multiline expression, and the `;;` is found<br/>
at the end of the second line.<br/>
</aside>
</section>
<section >
<h3>Enter <code>quit;;</code></h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="o">&gt;</span> #<span class="i">quit</span>;;

<span class="o">-</span> <span class="i">Exit</span><span class="o">..</span><span class="o">.</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
You can exit the F# Interactive prompt with the `#quit;;` command.<br/>
</aside>
</section>
</section>
<section >
<section >
<h2>Creating and Running Scripts</h2>
<aside class="notes">
While you can use F# Interactive directly, you'll find it is far<br/>
more effective to work with script files. F# Interactive was designed<br/>
more as an execution environment than an editing environment and therefore<br/>
provides no syntax highlighting or code completion, at least in most<br/>
environments.<br/>
</aside>
</section>
<section >
<h3>Open a Text Editor</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="o">$</span> <span class="i">cd</span> <span class="o">~/</span><span class="i">scripting</span><span class="o">-</span><span class="i">workshop</span><span class="o">/</span><span class="i">exercises</span>
<span class="o">$</span> <span class="i">code</span> <span class="i">Script</span><span class="o">.</span><span class="i">fsx</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
Let's create a script file with extension `.fsx`.<br/>
Open your favorite IDE or text editor. I'll be using VS Code with Ionide,<br/>
but you can follow along just as well with Visual Studio, Visual Studio for Mac,<br/>
Atom with Ionide, Emacs, Vim, etc. Most editors have an F# plugin<br/>
to provide syntax highlighting at a minimum, as well as F# Interactive integration.<br/>
</aside>
</section>
<section >
<h3>Enter the following code snippets:</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span class="i">MyClass</span>() <span class="o">=</span>
    <span class="k">member</span> <span class="k">val</span> <span class="i">Name</span> <span class="o">=</span> <span class="s">&quot;&quot;</span> <span class="k">with</span> <span class="i">get</span>, <span class="i">set</span>
    <span class="k">member</span> <span class="i">this</span><span class="o">.</span><span class="i">Sum</span>(<span class="i">x</span>, <span class="i">y</span>) <span class="o">=</span> <span class="i">x</span> <span class="o">+</span> <span class="i">y</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">x</span> <span class="o">=</span> <span class="i">MyClass</span>(<span class="i">Name</span> <span class="o">=</span> <span class="s">&quot;Some Name&quot;</span>)
<span class="k">let</span> <span class="i">result</span> <span class="o">=</span> <span class="i">x</span><span class="o">.</span><span class="i">Sum</span>(<span class="n">2</span>, <span class="n">2</span>)
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">printfn</span> <span class="s">&quot;%s: %i&quot;</span> <span class="i">x</span><span class="o">.</span><span class="i">Name</span> <span class="i">result</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
This code is nothing special. It's merely a snippet to give you<br/>
more than just `2 + 2`. Feel free to write any other F# code you<br/>
like if this snippet gives you the heebie-jeebies.<br/>
We are artists, after all.<br/>
</aside>
</section>
<section >
<h3>Run the Script</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="o">$</span> <span class="i">fsharpi</span> <span class="i">Script</span><span class="o">.</span><span class="i">fsx</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>Some Name: 4</code></pre></td></tr></table>
<aside class="notes">
You can run the script in several ways.<br/>
You can run it from the command line, as I show above.<br/>
We can also run from the editor, in most cases.<br/>
I have the script opened in Visual Studio Code.<br/>
I can run the script by pressing Alt-Enter or by<br/>
going to the VS Code commands and running the script.<br/>
This same approach should work with any editor you are using,<br/>
though the commands to run the script may differ.<br/>
</aside>
</section>
<section >
<p><img src="images/ecstasy.png" alt="ecstasy" /></p>
<aside class="notes">
That wasn't so bad. Now you know how to create and run scripts.<br/>
You most likely already knew at least this much, which is why<br/>
we are quickly moving on ...<br/>
</aside>
</section>
</section>
<section >
<section >
<h2>Loading and Referencing Files</h2>
<aside class="notes">
It's unlikely you'll have many uses for a script as isolated as the<br/>
one above. It's also unwise to try to maintain scripts exceeding<br/>
hundreds or thousands of lines. At some point, you'll want to break<br/>
your script up or reference files or assemblies to provide more<br/>
functionality.<br/>
</aside>
</section>
<section >
<h3>Finding FSI</h3>
<ul>
<li>Windows: C:\Program Files (x86)\Microsoft SDKs\F#\<version>\Framework\<version>\</li>
<li>e.g. C:\Program Files (x86)\Microsoft SDKs\F#\4.1\Framework\v4.0\fsiAnyCPU.exe</li>
<li>Mac/Linux: fsharpi (via mono)</li>
</ul>
</section>
<section >
<h3>References</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#r</span> <span class="s">&quot;System.Configuration.dll&quot;</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
You reference assemblies with the `#r` directive, followed by the<br/>
path to the assembly. For assemblies stored in the Global Assembly<br/>
Cache, or GAC, you can simply reference the assembly filename.<br/>
Make sure to include the `.dll` suffix, as this needs to be the actual<br/>
filename.<br/>
Note: `#r` uses the script's directory as the relative path to the reference.<br/>
</aside>
</section>
<section >
<h3>CLI References</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="o">$</span> <span class="i">fsharpi</span> <span class="o">--</span><span class="i">reference</span><span class="o">:</span><span class="i">System</span><span class="o">.</span><span class="i">Configuration</span><span class="o">.</span><span class="i">dll</span>

<span class="i">F#</span> <span class="i">Interactive</span> <span class="k">for</span> <span class="i">F#</span> <span class="n">4.1</span>
<span class="i">Freely</span> <span class="i">distributed</span> <span class="i">under</span> <span class="i">the</span> <span class="i">Apache</span> <span class="n">2.0</span> <span class="i">Open</span> <span class="i">Source</span> <span class="i">License</span>

<span class="i">For</span> <span class="i">help</span> <span class="k">type</span> #<span class="i">help</span>;;

<span class="o">&gt;</span> <span class="k">open</span> <span class="i">System</span><span class="o">.</span><span class="i">Configuration</span>;;
<span class="o">&gt;</span> <span class="i">ConfigurationManager</span><span class="o">.</span><span class="i">AppSettings</span>;;    
<span class="k">val</span> <span class="i">it</span> <span class="o">:</span> <span class="i">System</span><span class="o">.</span><span class="i">Collections</span><span class="o">.</span><span class="i">Specialized</span><span class="o">.</span><span class="i">NameValueCollection</span> <span class="o">=</span> <span class="i">seq</span> []

<span class="o">&gt;</span> 
</code></pre></td>
</tr>
</table>
<aside class="notes">
You can also add references on the command line. This is useful if you<br/>
a) always want a specific set of references available when running FSI<br/>
or b) want to avoid adding `#r` directives in your scripts.<br/>
Another possibility is to use this and the `no-framework` directive<br/>
to override the version of `FSharp.Core` loaded in Visual Studio 2015's<br/>
F# Interactive. However, this is beyond the scope of this workshop.<br/>
</aside>
</section>
<section >
<p><img src="images/ecstasy.png" alt="ecstasy" /></p>
<aside class="notes">
Easy peasy<br/>
</aside>
</section>
<section >
<h3>Loading Files</h3>
<p>Create a new file, <code>Library.fs</code>.</p>
<aside class="notes">
You reference assemblies, and you load files. You can load either<br/>
`.fsi`, `.fs`, or `.fsx` files. Let's add a library file and move<br/>
our `type` definition into it.<br/>
</aside>
</section>
<section >
<h3>Files so far</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="o">-</span> <span class="i">scripting</span><span class="o">-</span><span class="i">workshop</span>
  <span class="o">-</span> <span class="i">exercises</span>
    <span class="o">-</span> <span class="i">Library</span><span class="o">.</span><span class="i">fs</span>
    <span class="o">-</span> <span class="i">Script</span><span class="o">.</span><span class="i">fsx</span>
</code></pre></td>
</tr>
</table>
</section>
<section >
<h3>Library.fs</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span class="i">MyClass</span>() <span class="o">=</span>
    <span class="k">member</span> <span class="k">val</span> <span class="i">Name</span> <span class="o">=</span> <span class="s">&quot;&quot;</span> <span class="k">with</span> <span class="i">get</span>, <span class="i">set</span>
    <span class="k">member</span> <span class="i">this</span><span class="o">.</span><span class="i">Sum</span>(<span class="i">x</span>, <span class="i">y</span>) <span class="o">=</span> <span class="i">x</span> <span class="o">+</span> <span class="i">y</span>
</code></pre></td>
</tr>
</table>
</section>
<section >
<h3>Script.fsx</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#r</span> <span class="s">&quot;System.Configuration.dll&quot;</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">x</span> <span class="o">=</span> <span class="i">MyClass</span>(<span class="i">Name</span> <span class="o">=</span> <span class="s">&quot;Some Name&quot;</span>)
<span class="k">let</span> <span class="i">result</span> <span class="o">=</span> <span class="i">x</span><span class="o">.</span><span class="i">Sum</span>(<span class="n">2</span>, <span class="n">2</span>)
</code></pre></td>
</tr>
</table>
<aside class="notes">
This is the state of our script so far. However, there's a problem.<br/>
We no longer have access to the `MyClass` type.<br/>
</aside>
</section>
<section >
<h3>Script.fsx</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#r</span> <span class="s">&quot;System.Configuration.dll&quot;</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#load</span> <span class="s">&quot;Library.fs&quot;</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">x</span> <span class="o">=</span> <span class="i">MyClass</span>(<span class="i">Name</span> <span class="o">=</span> <span class="s">&quot;Some Name&quot;</span>)
<span class="k">let</span> <span class="i">result</span> <span class="o">=</span> <span class="i">x</span><span class="o">.</span><span class="i">Sum</span>(<span class="n">2</span>, <span class="n">2</span>)
</code></pre></td>
</tr>
</table>
<aside class="notes">
We can fix this using the `#load` directive.<br/>
</aside>
</section>
<section >
<h3>Run Script.fsx</h3>
<aside class="notes">
Now, run the script again.<br/>
</aside>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="o">$</span> <span class="i">fsharpi</span> <span class="i">Script</span><span class="o">.</span><span class="i">fsx</span>
<span class="o">/</span><span class="i">Script</span><span class="o">.</span><span class="i">fsx</span>(<span class="n">3</span>,<span class="n">9</span>)<span class="o">:</span> <span class="i">error</span> <span class="i">FS0039</span><span class="o">:</span> <span class="i">The</span> <span class="i">value</span> <span class="k">or</span> <span class="i">constructor</span> <span class="o">&#39;</span><span class="i">MyClass&#39;</span> <span class="i">is</span> <span class="i">not</span> <span class="i">defined</span><span class="o">.</span>
</code></pre></td>
</tr>
</table>
</section>
<section >
<p><img src="images/agony.png" alt="agony" /></p>
</section>
<section >
<h3>What went wrong?</h3>
<aside class="notes">
If you are using an editor like VS or VS Code with Ionide,<br/>
your script likely shows red error squiggles. The problem<br/>
is that there's no namespace provided in `Library.fs` yet,<br/>
so F# Interactive assumes a namespace based on the filename.<br/>
</aside>
</section>
<section >
<h3>Script.fsx</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#r</span> <span class="s">&quot;System.Configuration.dll&quot;</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#load</span> <span class="s">&quot;Library.fs&quot;</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span class="i">Library</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">x</span> <span class="o">=</span> <span class="i">MyClass</span>(<span class="i">Name</span> <span class="o">=</span> <span class="s">&quot;Some Name&quot;</span>)
<span class="k">let</span> <span class="i">result</span> <span class="o">=</span> <span class="i">x</span><span class="o">.</span><span class="i">Sum</span>(<span class="n">2</span>, <span class="n">2</span>)
</code></pre></td>
</tr>
</table>
<aside class="notes">
By opening the `Library` namespace, we can get the script to run properly.<br/>
Alternatively, you could provide a namespace in `Library.fs`, which is<br/>
more practical since you'll want that if you plan to use it in a library<br/>
or executable.<br/>
</aside>
</section>
<section >
<h3>Library.fs</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">S</span><span class="o">:</span>
<span class="i">Files</span> <span class="k">in</span> <span class="i">libraries</span> <span class="k">or</span> <span class="i">multiple</span><span class="o">-</span><span class="i">file</span> <span class="i">applications</span> <span class="i">must</span> <span class="k">begin</span>
<span class="k">with</span> <span class="i">a</span> <span class="k">namespace</span> <span class="k">or</span> <span class="k">module</span> <span class="i">declaration</span>, <span class="i">e</span><span class="o">.</span><span class="i">g</span><span class="o">.</span> <span class="o">&#39;</span><span class="k">namespace</span> <span class="i">SomeNamespace</span><span class="o">.</span><span class="i">SubNamespace&#39;</span>
<span class="k">or</span> <span class="o">&#39;</span><span class="k">module</span> <span class="i">SomeNamespace</span><span class="o">.</span><span class="i">SomeModule&#39;</span><span class="o">.</span> <span class="i">Only</span> <span class="i">the</span> <span class="i">last</span> <span class="i">source</span> <span class="i">file</span>
<span class="k">of</span> <span class="i">an</span> <span class="i">application</span> <span class="i">may</span> <span class="i">omit</span> <span class="i">such</span> <span class="i">a</span> <span class="i">declaration</span><span class="o">.</span>

<span class="k">namespace</span> <span class="i">Library</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
If you try to run Script.fsx from the command line, you'll see this error.<br/>
.fs files _should_ have a namespace or module, so go ahead and add<br/>
namespace Library to the top to resolve this error.<br/>
</aside>
</section>
<section >
<p><img src="images/ecstasy.png" alt="ecstasy" /></p>
</section>
</section>
<section >
<h2>Iterating Design</h2>
<p><img src="images/ecstasy.png" alt="ecstasy" /></p>
<aside class="notes">
Incidentally, this is a very common workflow when designing an application's types.<br/>
You write some code, test it out, modify, then move it into a source file once you<br/>
like the design. You can leave some of the exercise code in the script for later<br/>
iteration or evaluation.<br/>
Design applies to both domain modeling and data modeling.<br/>
For domain modeling, you may want to use scripts to understand<br/>
the ramifications of certain design decisions. For example,<br/>
is a record the right type, or might you need a discriminated<br/>
union to better cover multiple cases, especially if you may need<br/>
more in the future. How might units of measure help or hinder?<br/>
With respect to data modeling, it can be helpful to throw the<br/>
data in a plot. Interactive sessions work well for this, and you<br/>
can check calculations more easily with visualizations.<br/>
</aside>
</section>
<section >
<section >
<h2>Referencing NuGet Packages</h2>
<aside class="notes">
We now know how to reference assmblies available on the local machine,<br/>
as well as files. But what about NuGet packages?<br/>
</aside>
</section>
<section >
<h3><code>nuget.exe</code></h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#r</span> <span class="s">&quot;../packages/Argu.3.7.0/lib/net40/Argu.dll&quot;</span> 
<span class="prep">#r</span> <span class="s">&quot;../packages/FSharp.Data.2.3.3/lib/net40/FSharp.Data.dll&quot;</span> 
</code></pre></td>
</tr>
</table>
<aside class="notes">
If you are using NuGet directly, you will find yourself in a world of pain<br/>
and anguish. NuGet installs packages with the version as part of the file<br/>
path by default. While this is helpful if you want multiple versions, it's<br/>
unlikely that is the case. Sure, you can tediously hand-write all the references<br/>
in only a little bit of time, but what happens once you need to update packages?<br/>
In addition, you must also reference any of the package dependencies of each<br/>
referenced package. As you can imagine, this can become quite daunting.<br/>
</aside>
</section>
<section >
<p><img src="images/agony.png" alt="agony" /></p>
</section>
<section >
<h3><a href="https://fsprojects.github.io/Paket">Paket</a></h3>
<ul>
<li>No versions in paths</li>
<li>Consistent, locked versions</li>
<li>Dependency groups</li>
<li><code>generate-load-scripts</code></li>
</ul>
<aside class="notes">
Paket provides a terrific alternative to NuGet. By default, it _does not_<br/>
include paths in versions making your references less prone to breaking.<br/>
It maintains consistent versions throughout your project, so you can't<br/>
accidentally reference different versions of the same dependency.<br/>
You _can_ group dependencies so that you may use different versions of<br/>
a dependency in different contexts. Lastly, and best of all, it provides<br/>
a `generate-load-scripts` command with which you can easily create a single<br/>
load script for all of your paket dependencies.<br/>
Some editors provide utilties for generating package load scripts, but<br/>
the paket command allows you to switch editors at will without worrying<br/>
about different behaviors across editors. This is especially helpful in a<br/>
team setting.<br/>
</aside>
</section>
<section >
<p><img src="images/ecstasy.png" alt="ecstasy" /></p>
</section>
<section >
<h3>Add Packages</h3>
<aside class="notes">
Open the `paket.dependencies` file at the root of the `scripting-workshop`<br/>
folder and add the following dependenices, which we will use throughout<br/>
the rest of the workshop:<br/>
</aside>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">nuget</span> <span class="i">Argu</span>
<span class="i">nuget</span> <span class="i">Expecto</span>
<span class="i">nuget</span> <span class="i">Expecto</span><span class="o">.</span><span class="i">BenchmarkDotNet</span>
<span class="i">nuget</span> <span class="i">Expecto</span><span class="o">.</span><span class="i">FsCheck</span>
<span class="i">nuget</span> <span class="i">FSharp</span><span class="o">.</span><span class="i">Configuration</span>
<span class="i">nuget</span> <span class="i">FSharp</span><span class="o">.</span><span class="i">Data</span>
<span class="i">nuget</span> <span class="i">XPlot</span><span class="o">.</span><span class="i">GoogleCharts</span>
</code></pre></td>
</tr>
</table>
</section>
<section >
<h3>Generate Load Scripts</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="o">.</span><span class="o">/.</span><span class="i">paket</span><span class="o">/</span><span class="i">paket</span><span class="o">.</span><span class="i">exe</span> <span class="i">generate</span><span class="o">-</span><span class="i">load</span><span class="o">-</span><span class="i">scripts</span> <span class="o">--</span><span class="i">group</span> <span class="i">main</span> <span class="o">--</span><span class="k">type</span> <span class="i">fsx</span> <span class="o">--</span><span class="i">framework</span> <span class="i">net461</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
Run the paket command to generate fsx load scripts for group main and<br/>
framework net461. This will generate the references necessary for our<br/>
use and no more. Note that you can specify different groups and types,<br/>
the other type being csx for C# Interactive.<br/>
NOTE: if you are on Mac or Linux, you'll need to prefix the above with `mono`.<br/>
</aside>
</section>
<section >
<h3>Load Dependencies</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#load</span> <span class="s">&quot;../.paket/load/net461/main.group.fsx&quot;</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
We can now reference all of our references in one fell swoop!<br/>
</aside>
</section>
<section >
<p><img src="images/ecstasy.png" alt="ecstasy" /></p>
</section>
</section>
<section >
<section >
<h2>Accessing Values from .config Files</h2>
<aside class="notes">
We are about to switch to accessing a data set. However, the data set<br/>
we want requires an application key. Where do you typically store such<br/>
secrets? In a config file, of course!<br/>
</aside>
</section>
<section >
<h3>Add an <code>App.config</code> file</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="o">&lt;?</span><span class="i">xml</span> <span class="i">version</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span> <span class="i">encoding</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="o">?&gt;</span>
<span class="o">&lt;</span><span class="i">configuration</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="i">appSettings</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="i">add</span> <span class="i">key</span><span class="o">=</span><span class="s">&quot;AppKey&quot;</span> <span class="i">value</span><span class="o">=</span><span class="s">&quot;7B7EB384FEBA4409B56066FF63F1E8D0&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="i">add</span> <span class="i">key</span><span class="o">=</span><span class="s">&quot;test2&quot;</span> <span class="i">value</span><span class="o">=</span><span class="s">&quot;Some Test Value 5&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="i">add</span> <span class="i">key</span><span class="o">=</span><span class="s">&quot;TestInt&quot;</span> <span class="i">value</span><span class="o">=</span><span class="s">&quot;102&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="i">add</span> <span class="i">key</span><span class="o">=</span><span class="s">&quot;TestBool&quot;</span> <span class="i">value</span><span class="o">=</span><span class="s">&quot;True&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="i">add</span> <span class="i">key</span><span class="o">=</span><span class="s">&quot;TestDouble&quot;</span> <span class="i">value</span><span class="o">=</span><span class="s">&quot;10.01&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="i">add</span> <span class="i">key</span><span class="o">=</span><span class="s">&quot;TestTimeSpan&quot;</span> <span class="i">value</span><span class="o">=</span><span class="s">&quot;2.01:02:03.444&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="i">add</span> <span class="i">key</span><span class="o">=</span><span class="s">&quot;TestDateTime&quot;</span> <span class="i">value</span><span class="o">=</span><span class="s">&quot;02/01/2014 03:04:05.777&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="i">add</span> <span class="i">key</span><span class="o">=</span><span class="s">&quot;TestUri&quot;</span> <span class="i">value</span><span class="o">=</span><span class="s">&quot;http://fsharp.org&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="i">add</span> <span class="i">key</span><span class="o">=</span><span class="s">&quot;TestGuid&quot;</span> <span class="i">value</span><span class="o">=</span><span class="s">&quot;{7B7EB384-FEBA-4409-B560-66FF63F1E8D0}&quot;</span> <span class="o">/&gt;</span>
  <span class="o">&lt;/</span><span class="i">appSettings</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="i">connectionStrings</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="i">add</span> <span class="i">name</span><span class="o">=</span><span class="s">&quot;Test1&quot;</span>
      <span class="i">connectionString</span><span class="o">=</span><span class="s">&quot;Server=.;Database=myDataBase;Integrated Security=True;&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="i">add</span> <span class="i">name</span><span class="o">=</span><span class="s">&quot;Test2&quot;</span>
      <span class="i">connectionString</span><span class="o">=</span><span class="s">&quot;Server=.;Database=myDataBase2;Integrated Security=True;&quot;</span> <span class="o">/&gt;</span>
  <span class="o">&lt;/</span><span class="i">connectionStrings</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="i">configuration</span><span class="o">&gt;</span>
</code></pre></td>
</tr>
</table>
</section>
<section >
<h3>Create <code>AppSettings.fsx</code></h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#r</span> <span class="s">&quot;System.Configuration.dll&quot;</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span class="i">System</span><span class="o">.</span><span class="i">Configuration</span>

<span class="i">ConfigurationManager</span><span class="o">.</span><span class="i">AppSettings</span><span class="o">.</span>[<span class="s">&quot;test2&quot;</span>]
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>&lt;null&gt;</code></pre></td></tr></table>
<aside class="notes">
Create an AppSettings.fsx script to get a clean slate.<br/>
Add teh following code to retrieve the `test2` setting.<br/>
</aside>
</section>
<section >
<p><img src="images/agony.png" alt="agony" /></p>
</section>
<section >
<h3>What went wrong?</h3>
</section>
<section >
<h3>Problem 1: CurrentDirectory</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">System</span><span class="o">.</span><span class="i">Environment</span><span class="o">.</span><span class="i">CurrentDirectory</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>"S:\scripting-workshop\slides"</code></pre></td></tr></table>
<aside class="notes">
The first problem is that the script is not necessarily running it its own folder.<br/>
The current directory returned is the directory in which F# Interactive is running.<br/>
Depending on where and how you run your script, you may not be able to access<br/>
the config file you want.<br/>
</aside>
</section>
<section >
<h3>Change the Current Directory</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">System</span><span class="o">.</span><span class="i">Environment</span><span class="o">.</span><span class="i">CurrentDirectory</span> <span class="o">&lt;-</span> <span class="k">__SOURCE_DIRECTORY__</span>
<span class="i">System</span><span class="o">.</span><span class="i">Environment</span><span class="o">.</span><span class="i">CurrentDirectory</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>"S:\scripting-workshop\slides"</code></pre></td></tr></table>
<aside class="notes">
We can set the current directory using this line of code.<br/>
You'll typically want to work from your source directory.<br/>
Try adding this line just after opening `System.Configuration`,<br/>
restart your environment, and try again.<br/>
</aside>
</section>
<section >
<table class="pre"><tr><td><pre><code>&lt;null&gt;</code></pre></td></tr></table>
</section>
<section >
<p><img src="images/agony.png" alt="agony" /></p>
</section>
<section >
<h3>Problem 2: Script <> App</h3>
<aside class="notes">
You should still see nothing. That's expected. You are running a script,<br/>
and the script doesn't know how to access the config file. What's more,<br/>
`ConfigurationManager doesn't access an `App.config` file at runtime;<br/>
it accesses the program name `.dll.config` or `.exe.config`.<br/>
We can solve this in one of two ways.<br/>
</aside>
</section>
<section >
<h3>Solution 1: FSharp.Configuration</h3>
<aside class="notes">
We'll now take a look at the FSharp.Configuration type provider.<br/>
This is an excellent tool for accessing config file values and even <br/>
attempts to type check them for you.<br/>
</aside>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span class="i">FSharp</span><span class="o">.</span><span class="i">Configuration</span>

<span class="k">type</span> <span class="i">Settings1</span> <span class="o">=</span> <span class="i">AppSettings</span><span class="o">&lt;</span><span class="s">&quot;App.config&quot;</span><span class="o">&gt;</span>

<span class="c">// Enter:</span>
<span class="i">Settings1</span><span class="o">.</span><span class="i">Test2</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
What do you see when you try to enter `Settings1.Test2`?<br/>
</aside>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">error</span> <span class="i">FS0039</span><span class="o">:</span> <span class="i">The</span> <span class="i">field</span>, <span class="i">constructor</span> <span class="k">or</span> <span class="k">member</span> <span class="o">&#39;</span><span class="i">Test2&#39;</span> <span class="i">is</span> <span class="i">not</span> <span class="i">defined</span><span class="o">.</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
The most obvious thing, and the one that works when using the type provider in a library<br/>
or executable, fails in a script file. When using FSharp.Configuration in a script, you<br/>
have to also set the executable file.<br/>
</aside>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">Settings1</span><span class="o">.</span><span class="i">SelectExecutableFile</span> <span class="s">&quot;AppSettings.fsx&quot;</span>

<span class="i">Settings1</span><span class="o">.</span><span class="i">Test2</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
For a script, that is the script filename. Add the above lines and try to enter<br/>
`Settings1.Test2` again. Now what do you see?<br/>
</aside>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">error</span> <span class="i">FS0039</span><span class="o">:</span> <span class="i">The</span> <span class="i">field</span>, <span class="i">constructor</span> <span class="k">or</span> <span class="k">member</span> <span class="o">&#39;</span><span class="i">Test2&#39;</span> <span class="i">is</span> <span class="i">not</span> <span class="i">defined</span><span class="o">.</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
What's going on? If you think about it, you'll realize the problem. What's the<br/>
name of the `config` file once you've compiled a library or executable project?<br/>
It's Name.exe.config or Name.dll.config. FSharp.Configuration is anticipating the<br/>
same thing here.<br/>
</aside>
</section>
<section >
<h3>Rename App.config to AppSettings.fsx.config</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span class="i">Settings2</span> <span class="o">=</span> <span class="i">AppSettings</span><span class="o">&lt;</span><span class="s">&quot;AppSettings.fsx.config&quot;</span><span class="o">&gt;</span>
<span class="i">Settings2</span><span class="o">.</span><span class="i">SelectExecutableFile</span> <span class="s">&quot;AppSettings.fsx&quot;</span>

<span class="i">Settings2</span><span class="o">.</span><span class="i">Test2</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
Rename the App.config to AppSettings.fsx.config, the name the file would have<br/>
if you were to compile an application and try it again.<br/>
Note: I've renamed my Settings type here purely to help with generating slides.<br/>
</aside>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">error</span> <span class="i">FS0039</span><span class="o">:</span> <span class="i">The</span> <span class="i">field</span>, <span class="i">constructor</span> <span class="k">or</span> <span class="k">member</span> <span class="o">&#39;</span><span class="i">Test2&#39;</span> <span class="i">is</span> <span class="i">not</span> <span class="i">defined</span><span class="o">.</span>
</code></pre></td>
</tr>
</table>
</section>
<section >
<p><img src="images/agony.png" alt="agony" /></p>
<aside class="notes">
Are you serious?! What is going on here? Why are you playing tricks on me?!<br/>
This is the point where you begin to swear off scripting. Why must it be so<br/>
hard?!<br/>
</aside>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> [&lt;<span class="i">Literal</span>&gt;] <span class="i">AppSettingsConfig</span> <span class="o">=</span>
    <span class="k">__SOURCE_DIRECTORY__</span> <span class="o">+</span> <span class="s">&quot;/AppSettings.fsx.config&quot;</span>
<span class="k">type</span> <span class="i">Settings</span> <span class="o">=</span> <span class="i">AppSettings</span><span class="o">&lt;</span><span class="i">AppSettingsConfig</span><span class="o">&gt;</span>
<span class="k">let</span> [&lt;<span class="i">Literal</span>&gt;] <span class="i">AppSettingsExe</span> <span class="o">=</span>
    <span class="k">__SOURCE_DIRECTORY__</span> <span class="o">+</span> <span class="s">&quot;/AppSettings.fsx&quot;</span>
<span class="i">Settings</span><span class="o">.</span><span class="i">SelectExecutableFile</span> <span class="i">AppSettingsExe</span>

<span class="i">Settings</span><span class="o">.</span><span class="i">Test2</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
It turns out you need to specify the full path for this to work properly in scripts.<br/>
You can use the `__SOURCE_DIRECTORY__` directive to git the path to the current script<br/>
and then add the remaining file name part. This can be captured as a string literal,<br/>
so you can use it in places like type provider parameters.<br/>
If you run this now, you'll get the value from Test2.<br/>
Try some of the other settings, and you'll see that the type provider is quite handy<br/>
at returning values that are typed.<br/>
</aside>
</section>
<section >
<p><img src="images/ecstasy.png" alt="ecstasy" /></p>
</section>
<section >
<h3>Retrieve the value for AppKey</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">Settings</span><span class="o">.</span><span class="i">AppKey</span>
</code></pre></td>
</tr>
</table>
</section>
<section >
<table class="pre"><tr><td><pre><code>No value has been returned</code></pre></td></tr></table>
<aside class="notes">
The poor type provider was tricked. It found a string with the same length and<br/>
alphanumeric characteristics as a Guid, so it converted it.<br/>
</aside>
</section>
<section >
<p><img src="images/agony.png" alt="agony" /></p>
</section>
<section >
<h3>Solution 2: Override ConfigurationManager</h3>
<aside class="notes">
When all else fails, you can replace the System.Configuration.ConfigurationManager<br/>
with a simple script.<br/>
</aside>
</section>
<section >
<h3>Configuration.fsx</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#r</span> <span class="s">&quot;System.Xml.dll&quot;</span>
<span class="prep">#r</span> <span class="s">&quot;System.Xml.Linq.dll&quot;</span>
<span class="k">open</span> <span class="i">System</span><span class="o">.</span><span class="i">Xml</span>
<span class="k">open</span> <span class="i">System</span><span class="o">.</span><span class="i">Xml</span><span class="o">.</span><span class="i">Linq</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
Create a new file called Configuration.fsx. At the top, add references to System.Xml.dll<br/>
and System.Xml.Linq.dll, then open those namespaces.<br/>
</aside>
</section>
<section >
<h3>Configuration.fsx</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> [&lt;<span class="i">Literal</span>&gt;] <span class="i">AppSettingsPath</span> <span class="o">=</span> <span class="k">__SOURCE_DIRECTORY__</span> <span class="o">+</span> <span class="s">&quot;/App.config&quot;</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
Here we again use the absolute path string literal to specify the config file we want<br/>
to reference. This makes the script less portable, but it's the only way to properly<br/>
hijack the ConfigurationManager class, which uses static members.<br/>
</aside>
</section>
<section >
<h3>Configuration.fsx</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span class="i">ConfigurationManager</span>() <span class="o">=</span>
    <span class="k">static</span> <span class="k">let</span> <span class="i">config</span> <span class="o">=</span> <span class="i">XDocument</span><span class="o">.</span><span class="i">Load</span> <span class="i">AppSettingsPath</span>
    <span class="k">static</span> <span class="k">let</span> <span class="i">section</span> (<span class="i">config</span><span class="o">:</span><span class="i">XDocument</span>) <span class="i">name</span> <span class="i">key</span> <span class="i">value</span> <span class="o">=</span>
        <span class="i">query</span> {
            <span class="k">for</span> <span class="i">els</span> <span class="k">in</span> <span class="i">config</span><span class="o">.</span><span class="i">Descendants</span>(<span class="i">XName</span><span class="o">.</span><span class="i">Get</span> <span class="i">name</span>) <span class="k">do</span>
            <span class="k">for</span> <span class="i">el</span> <span class="k">in</span> <span class="i">els</span><span class="o">.</span><span class="i">Descendants</span>(<span class="i">XName</span><span class="o">.</span><span class="i">Get</span> <span class="s">&quot;add&quot;</span>) <span class="k">do</span>
            <span class="k">let</span> <span class="i">k</span> <span class="o">=</span> <span class="i">el</span><span class="o">.</span><span class="i">Attribute</span>(<span class="i">XName</span><span class="o">.</span><span class="i">Get</span> <span class="i">key</span>)<span class="o">.</span><span class="i">Value</span> 
            <span class="k">let</span> <span class="i">v</span> <span class="o">=</span> <span class="i">el</span><span class="o">.</span><span class="i">Attribute</span>(<span class="i">XName</span><span class="o">.</span><span class="i">Get</span> <span class="i">value</span>)<span class="o">.</span><span class="i">Value</span> 
            <span class="i">select</span> (<span class="i">k</span>,<span class="i">v</span>)
        } <span class="o">|&gt;</span> <span class="i">dict</span>
    <span class="k">static</span> <span class="k">let</span> <span class="i">appSettings</span> <span class="o">=</span>
        <span class="i">section</span> <span class="i">config</span> <span class="s">&quot;appSettings&quot;</span> <span class="s">&quot;key&quot;</span> <span class="s">&quot;value&quot;</span>
    <span class="k">static</span> <span class="k">let</span> <span class="i">connectionStrings</span> <span class="o">=</span>
        <span class="i">section</span> <span class="i">config</span> <span class="s">&quot;connectionStrings&quot;</span> <span class="s">&quot;name&quot;</span> <span class="s">&quot;connectionString&quot;</span>
    <span class="k">static</span> <span class="k">member</span> <span class="i">AppSettings</span> <span class="o">=</span> <span class="i">appSettings</span>
    <span class="k">static</span> <span class="k">member</span> <span class="i">ConnectionStrings</span> <span class="o">=</span> <span class="i">connectionStrings</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
The guts of the ConfigurationManager class are not that complex. We have a static, let-bound<br/>
function that loads and queries the provides config file and returns it as a dictionary, based<br/>
on the section. I've only implemented the appSettings and connectionStrings portions here, but<br/>
you can certainly add sections you want or need.<br/>
</aside>
</section>
<section >
<h3>Use Configuration.fsx</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#load</span> <span class="s">&quot;Configuration.fsx&quot;</span>
<span class="k">open</span> <span class="i">Configuration</span>

<span class="i">ConfigurationManager</span><span class="o">.</span><span class="i">AppSettings</span><span class="o">.</span>[<span class="s">&quot;AppKey&quot;</span>]
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>"9050511f2aa54cc1a2be31a64af63804"</code></pre></td></tr></table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">ConfigurationManager</span><span class="o">.</span><span class="i">ConnectionStrings</span><span class="o">.</span>[<span class="s">&quot;Test1&quot;</span>]
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>"Server=.;Database=myDataBase;Integrated Security=True;"</code></pre></td></tr></table>
<aside class="notes">
Go back to your AppSettings.fsx script and enter the following lines. Remembering that the<br/>
script name is used as the namespace, we open Configuration after loading the file. So long<br/>
as you load and open this Configuraiton after System.Configuration, this will hide the<br/>
System.Configuration.ConfigurationManager, and you will be able to access whatever file you've<br/>
specified in the Configuration.fsx script.<br/>
</aside>
</section>
<section >
<p><img src="images/ecstasy.png" alt="ecstasy" /></p>
</section>
<section >
<h3>Remember: Always Use <code>__SOURCE_DIRECTORY__</code></h3>
<aside class="notes">
You now have two possible solutions you can leverage in your scripts. These strategies<br/>
work for connection strings used with the various type providers, as well. It's always<br/>
a good strategy to prefix a path to a config file with `__SOURCE_DIRECTORY__` to avoid<br/>
issues with your scripts.<br/>
</aside>
</section>
</section>
<section >
<section >
<h2>Working with Data</h2>
<aside class="notes">
Let's start working on our ETL tool. First, we need to get some data.<br/>
Create a new script named App.fsx.<br/>
</aside>
</section>
<section >
<h3>OpenCage GeoCoder</h3>
<p><a href="https://geocoder.opencagedata.com/">https://geocoder.opencagedata.com/</a></p>
<aside class="notes">
We'll use OpenCage GeoCoder to retrieve a list of locations matching<br/>
a specified query parameter.<br/>
</aside>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span class="i">FSharp</span><span class="o">.</span><span class="i">Data</span>

<span class="k">let</span> <span class="i">appKey</span> <span class="o">=</span> <span class="i">ConfigurationManager</span><span class="o">.</span><span class="i">AppSettings</span><span class="o">.</span>[<span class="s">&quot;AppKey&quot;</span>]

<span class="k">let</span> [&lt;<span class="i">Literal</span>&gt;] <span class="i">``geocoding.json``</span> <span class="o">=</span>
    <span class="k">__SOURCE_DIRECTORY__</span> <span class="o">+</span> <span class="s">&quot;/geocoding.json&quot;</span>
<span class="k">type</span> <span class="i">Location</span> <span class="o">=</span> <span class="i">JsonProvider</span><span class="o">&lt;</span><span class="i">``geocoding.json``</span><span class="o">&gt;</span>

<span class="k">let</span> <span class="i">extract</span> <span class="i">city</span> <span class="o">=</span>
    <span class="k">let</span> <span class="i">uri</span> <span class="o">=</span>
        <span class="s">&quot;https://api.opencagedata.com/geocode/v1/json?q=&quot;</span>
        <span class="o">+</span> <span class="i">city</span>
        <span class="o">+</span> <span class="s">&quot;&amp;pretty=1&amp;no_annotations=1&amp;key=&quot;</span>
        <span class="o">+</span> <span class="i">appKey</span>
    <span class="i">Location</span><span class="o">.</span><span class="i">Load</span>(<span class="i">uri</span>)
</code></pre></td>
</tr>
</table>
<aside class="notes">
This is quite a bit of code, so let's break it down.<br/>
First, we are using FSharp.Data.JsonProvider, so we<br/>
need to open FSharp.Data<br/>
I've taken the liberty to save a copy of a sample<br/>
response. When using JsonProvider with scripts, it's<br/>
often helpful to copy the response. In this case, the<br/>
API call is rate limited, so using the actual url to<br/>
request a response to generate types can cost you a<br/>
number of requests, especially if you are reloading your<br/>
interactive environment often.<br/>
The response output is used to define a type called Location.<br/>
The extract function accepts a city (or general location),<br/>
populates the request URI with the input and the appKey,<br/>
then loads the response into the Location type.<br/>
</aside>
</section>
<section >
<h3>Call <code>extract</code></h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">result</span> <span class="o">=</span> <span class="i">extract</span> <span class="s">&quot;Adelaide&quot;</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
You should receive a result with one or more location results.<br/>
It should match the format of the geocoding.json file.<br/>
</aside>
</section>
<section >
<h2>Leveraging Scripts for <acronym title="Extract-Transform-Load">ETL</acronym></h2>
<aside class="notes">
We have some data, but what can you do with it? Let's look at how we might<br/>
write a little extract-transform-load script.<br/>
</aside>
</section>
<section >
<h3>Defining Domain Types</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span class="i">LocationResult</span> <span class="o">=</span>
  { <span class="i">DisplayName</span> <span class="o">:</span> <span class="i">string</span>
    <span class="i">Latitude</span> <span class="o">:</span> <span class="i">float</span>
    <span class="i">Longitude</span> <span class="o">:</span> <span class="i">float</span>
    <span class="i">City</span> <span class="o">:</span> <span class="i">string</span>
    <span class="i">State</span> <span class="o">:</span> <span class="i">string</span>
    <span class="i">Country</span> <span class="o">:</span> <span class="i">string</span>
    <span class="i">CountryCode</span> <span class="o">:</span> <span class="i">string</span>
    <span class="i">EnergyUse</span> <span class="o">:</span> <span class="i">Runtime</span><span class="o">.</span><span class="i">WorldBank</span><span class="o">.</span><span class="i">Indicator</span> <span class="i">option</span> }
</code></pre></td>
</tr>
</table>
<aside class="notes">
While the type provider generates a type matching the source data,<br/>
we don't want either the returned shape nor all the detail returned.<br/>
Let's define our own LocationResult type into which we'll format<br/>
our data set.<br/>
</aside>
</section>
<section >
<h3>Define <code>transformSimple</code></h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">transformSimple</span> (<span class="i">source</span><span class="o">:</span><span class="i">Location</span><span class="o">.</span><span class="i">Root</span>) <span class="o">:</span> <span class="i">LocationResult</span> <span class="i">list</span> <span class="o">=</span>
    [ <span class="k">for</span> <span class="i">result</span> <span class="k">in</span> <span class="i">source</span><span class="o">.</span><span class="i">Results</span> <span class="k">-&gt;</span>
        { <span class="i">DisplayName</span> <span class="o">=</span> <span class="i">result</span><span class="o">.</span><span class="i">Formatted</span>
          <span class="i">Latitude</span> <span class="o">=</span> <span class="i">float</span> <span class="i">result</span><span class="o">.</span><span class="i">Geometry</span><span class="o">.</span><span class="i">Lat</span>
          <span class="i">Longitude</span> <span class="o">=</span> <span class="i">float</span> <span class="i">result</span><span class="o">.</span><span class="i">Geometry</span><span class="o">.</span><span class="i">Lng</span>
          <span class="i">City</span> <span class="o">=</span> <span class="i">result</span><span class="o">.</span><span class="i">Components</span><span class="o">.</span><span class="i">City</span>
          <span class="i">State</span> <span class="o">=</span> <span class="i">result</span><span class="o">.</span><span class="i">Components</span><span class="o">.</span><span class="i">State</span>
          <span class="i">Country</span> <span class="o">=</span> <span class="i">result</span><span class="o">.</span><span class="i">Components</span><span class="o">.</span><span class="i">Country</span>
          <span class="i">CountryCode</span> <span class="o">=</span> <span class="i">result</span><span class="o">.</span><span class="i">Components</span><span class="o">.</span><span class="i">Iso31661Alpha2</span>
          <span class="i">EnergyUse</span> <span class="o">=</span> <span class="i">None</span> }
    ]
</code></pre></td>
</tr>
</table>
<aside class="notes">
Here I've defined transformSimple, a version of our transform function<br/>
that doesn't populate the EnergyUse property. More on that in a bit.<br/>
This is not all that complex, and that's really the beauty of using<br/>
F# for this type of work. Translations are simple functions mapping<br/>
one type to another.<br/>
</aside>
</section>
<section >
<h3>World Bank Data</h3>
<aside class="notes">
However, we want additional data about energy use for the location.<br/>
Let's use the World Bank type provider to look up energy use for the<br/>
country location to demonstrate a) the ability to mix data sets from<br/>
different sources easily and b) provide something more useful than<br/>
simple location data for our ETL application.<br/>
</aside>
</section>
<section >
<h3>Define <code>transform</code></h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">extractEnergyUse</span> (<span class="i">result</span><span class="o">:</span><span class="i">Location</span><span class="o">.</span><span class="i">Result</span>)
        (<span class="i">wb</span><span class="o">:</span><span class="i">WorldBankData</span><span class="o">.</span><span class="i">ServiceTypes</span><span class="o">.</span><span class="i">WorldBankDataService</span>) <span class="o">=</span>
    <span class="i">wb</span><span class="o">.</span><span class="i">Countries</span>
    <span class="o">|&gt;</span> <span class="i">Seq</span><span class="o">.</span><span class="i">tryFind</span> (<span class="k">fun</span> <span class="i">x</span> <span class="k">-&gt;</span>
        <span class="i">result</span><span class="o">.</span><span class="i">Components</span><span class="o">.</span><span class="i">Country</span><span class="o">.</span><span class="i">StartsWith</span>(<span class="i">x</span><span class="o">.</span><span class="i">Name</span>))
    <span class="o">|&gt;</span> <span class="i">Option</span><span class="o">.</span><span class="i">map</span> (<span class="k">fun</span> <span class="i">x</span> <span class="k">-&gt;</span>
        <span class="i">x</span><span class="o">.</span><span class="i">Indicators</span><span class="o">.</span><span class="i">``Energy use (kg of oil equivalent per capita)``</span>)

<span class="k">let</span> <span class="i">transform</span> (<span class="i">source</span><span class="o">:</span><span class="i">Location</span><span class="o">.</span><span class="i">Root</span>) <span class="o">:</span> <span class="i">LocationResult</span> <span class="i">list</span> <span class="o">=</span>
    <span class="k">let</span> <span class="i">wb</span> <span class="o">=</span> <span class="i">WorldBankData</span><span class="o">.</span><span class="i">GetDataContext</span>()
    [ <span class="k">for</span> <span class="i">result</span> <span class="k">in</span> <span class="i">source</span><span class="o">.</span><span class="i">Results</span> <span class="k">-&gt;</span>
        <span class="k">let</span> <span class="i">energyUse</span> <span class="o">=</span> <span class="i">extractEnergyUse</span> <span class="i">result</span> <span class="i">wb</span>
        { <span class="i">DisplayName</span> <span class="o">=</span> <span class="i">result</span><span class="o">.</span><span class="i">Formatted</span>
          <span class="i">Latitude</span> <span class="o">=</span> <span class="i">float</span> <span class="i">result</span><span class="o">.</span><span class="i">Geometry</span><span class="o">.</span><span class="i">Lat</span>
          <span class="i">Longitude</span> <span class="o">=</span> <span class="i">float</span> <span class="i">result</span><span class="o">.</span><span class="i">Geometry</span><span class="o">.</span><span class="i">Lng</span>
          <span class="i">City</span> <span class="o">=</span> <span class="i">result</span><span class="o">.</span><span class="i">Components</span><span class="o">.</span><span class="i">City</span>
          <span class="i">State</span> <span class="o">=</span> <span class="i">result</span><span class="o">.</span><span class="i">Components</span><span class="o">.</span><span class="i">State</span>
          <span class="i">Country</span> <span class="o">=</span> <span class="i">result</span><span class="o">.</span><span class="i">Components</span><span class="o">.</span><span class="i">Country</span>
          <span class="i">CountryCode</span> <span class="o">=</span> <span class="i">result</span><span class="o">.</span><span class="i">Components</span><span class="o">.</span><span class="i">Iso31661Alpha2</span>
          <span class="i">EnergyUse</span> <span class="o">=</span> <span class="i">energyUse</span> }
    ]
</code></pre></td>
</tr>
</table>
<aside class="notes">
The World Bank type provider already understands how to translate<br/>
HTTP requests from the World Bank and provides a number of indicators.<br/>
Define extractEnergyUse to retrieve World Bank indicators for each<br/>
result. We'll also parameterize the data context used to access<br/>
the World Bank so we don't have to re-create it for each request.<br/>
</aside>
</section>
<section >
<h3>Persisting Data</h3>
<aside class="notes">
You may typically use SQL databases when manipulating data, but we'll<br/>
use CSV for this exercise. Fortunately, FSharp.Data provides the CsvProvider<br/>
with which we can read from and create CSV files.<br/>
</aside>
</section>
<section >
<h3>CsvProvider</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span class="i">LocationSink</span> <span class="o">=</span>
    <span class="i">CsvProvider</span><span class="o">&lt;</span><span class="s">&quot;Location (string),Latitude (float),Longitude (float),City (string),State (string),Country (string),CountryCode (string)&quot;</span><span class="o">&gt;</span>
<span class="k">type</span> <span class="i">EnergyUseSink</span> <span class="o">=</span>
    <span class="i">CsvProvider</span><span class="o">&lt;</span><span class="s">&quot;CountryCode (string),EnergyUse (float)&quot;</span><span class="o">&gt;</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
You can find the full headers in the LocationSinkHeaders.txt and<br/>
EnergyUseSinkHeaders.txt files in the exercises folder.<br/>
</aside>
</section>
<section >
<h3>Define <code>load</code></h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">load</span> (<span class="i">data</span><span class="o">:</span><span class="i">LocationResult</span> <span class="i">list</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="i">locations</span>, <span class="i">energyUse</span> <span class="o">=</span>
        [ <span class="k">for</span> <span class="i">row</span> <span class="k">in</span> <span class="i">data</span> <span class="k">-&gt;</span>
            <span class="k">let</span> <span class="i">location</span> <span class="o">=</span>
                <span class="i">LocationSink</span><span class="o">.</span><span class="i">Row</span>(
                    <span class="i">row</span><span class="o">.</span><span class="i">DisplayName</span>, <span class="i">row</span><span class="o">.</span><span class="i">Latitude</span>,
                    <span class="i">row</span><span class="o">.</span><span class="i">Longitude</span>, <span class="i">row</span><span class="o">.</span><span class="i">City</span>,
                    <span class="i">row</span><span class="o">.</span><span class="i">State</span>, <span class="i">row</span><span class="o">.</span><span class="i">Country</span>,
                    <span class="i">row</span><span class="o">.</span><span class="i">CountryCode</span>
                )
            <span class="k">let</span> <span class="i">usage</span> <span class="o">=</span>
                <span class="k">match</span> <span class="i">row</span><span class="o">.</span><span class="i">EnergyUse</span> <span class="k">with</span>
                | <span class="i">Some</span> <span class="i">i</span> <span class="k">-&gt;</span>
                    [ <span class="k">for</span> <span class="i">y</span> <span class="k">in</span> <span class="n">1960..</span><span class="n">2012</span> <span class="k">-&gt;</span>
                        <span class="i">EnergyUseSink</span><span class="o">.</span><span class="i">Row</span>(<span class="i">row</span><span class="o">.</span><span class="i">CountryCode</span>, <span class="i">i</span><span class="o">.</span>[<span class="i">y</span>]) ]
                | <span class="i">None</span> <span class="k">-&gt;</span> []
            <span class="i">location</span>, <span class="i">usage</span>
        ]
        <span class="o">|&gt;</span> <span class="i">List</span><span class="o">.</span><span class="i">unzip</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
Once again, this is quite a lot of code in one snippet.<br/>
We are defining a list comprehension that traverses each<br/>
LocationResult and builds up pairs of LocationSink.Row and<br/>
EnergyUseSink.Row list results. We then unzip them to separate<br/>
the two lists.<br/>
</aside>
</section>
<section >
<h3>Define <code>load</code> (cont)</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">    <span class="k">do</span>
        <span class="k">use</span> <span class="i">locationSink</span> <span class="o">=</span> <span class="k">new</span> <span class="i">LocationSink</span>(<span class="i">locations</span>)
        <span class="i">locationSink</span><span class="o">.</span><span class="i">Save</span>(<span class="s">&quot;locations.csv&quot;</span>)
    <span class="k">do</span>
        <span class="k">let</span> <span class="i">distinct</span> <span class="o">=</span>
            <span class="i">List</span><span class="o">.</span><span class="i">concat</span> <span class="i">energyUse</span>
            <span class="o">|&gt;</span> <span class="i">List</span><span class="o">.</span><span class="i">distinctBy</span> (<span class="k">fun</span> <span class="i">x</span> <span class="k">-&gt;</span> <span class="i">x</span><span class="o">.</span><span class="i">CountryCode</span>)
        <span class="k">use</span> <span class="i">energyUseSink</span> <span class="o">=</span> <span class="k">new</span> <span class="i">EnergyUseSink</span>(<span class="i">distinct</span>)
        <span class="i">energyUseSink</span><span class="o">.</span><span class="i">Save</span>(<span class="s">&quot;energyUse.csv&quot;</span>)
</code></pre></td>
</tr>
</table>
<aside class="notes">
Now that we have the results, we need to create the CSV files.<br/>
We can load the row lists into their respective Sink types<br/>
and call Save, passing a file name.<br/>
For energyUse, since we may have multiple locations within the<br/>
same country, let's make sure to capture only distinct results<br/>
to avoid duplicates.<br/>
You would follow a similar approach when working with a SQL database.<br/>
</aside>
</section>
<section >
<h3>Define <code>run</code></h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">run</span> <span class="i">city</span> <span class="o">=</span>
    <span class="k">let</span> <span class="i">data</span> <span class="o">=</span> (<span class="i">extract</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="i">transform</span>) <span class="i">city</span>
    <span class="i">load</span> <span class="i">data</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
Let's define a run function to make it easier to run everything together.<br/>
Try it out. What sort of results are you getting? Look at the CSV results.<br/>
Are they what you would expect?<br/>
You can run just the `let data = (extract >> transform) "City"` to see the<br/>
LocationResults directly.<br/>
</aside>
</section>
<section >
<h3>Iterating Design</h3>
<aside class="notes">
I'd like to point out at this point that this would be a good time to move<br/>
our types to a library .fs file. However, we will leave them here for now.<br/>
</aside>
</section>
<section >
<p><img src="images/ecstasy.png" alt="ecstasy" /></p>
</section>
</section>
<section >
<section >
<h2>Testing</h2>
<aside class="notes">
Let's take an opportunity to test our code. There are multiple kinds of tests,<br/>
and we'll start with some simple performance testing. This won't be anything<br/>
spectacular; we'll simply leverage a directive available in F# Interactive.<br/>
</aside>
</section>
<section >
<h3><code>#time</code></h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="o">&gt;</span> #<span class="i">time</span>;;

<span class="o">--&gt;</span> <span class="i">Timing</span> <span class="i">now</span> <span class="i">on</span>

<span class="o">&gt;</span> <span class="i">run</span> <span class="s">&quot;Houston&quot;</span>;;
<span class="i">Real</span><span class="o">:</span> <span class="n">00</span><span class="o">:</span><span class="n">00</span><span class="o">:</span><span class="n">00.970</span>, <span class="i">CPU</span><span class="o">:</span> <span class="n">00</span><span class="o">:</span><span class="n">00</span><span class="o">:</span><span class="n">00.093</span>, <span class="i">GC</span> <span class="i">gen0</span><span class="o">:</span> <span class="n">1</span>, <span class="i">gen1</span><span class="o">:</span> <span class="n">0</span>, <span class="i">gen2</span><span class="o">:</span> <span class="n">0</span>
<span class="k">val</span> <span class="i">it</span> <span class="o">:</span> <span class="i">unit</span> <span class="o">=</span> ()

<span class="o">&gt;</span> #<span class="i">time</span>;;

<span class="o">--&gt;</span> <span class="i">Timing</span> <span class="i">now</span> <span class="i">off</span>

<span class="o">&gt;</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
There are multiple kinds of tests,<br/>
and we'll start with some simple performance testing. This won't be anything<br/>
spectacular; we'll simply leverage a directive available in F# Interactive.<br/>
</aside>
</section>
<section >
<p><img src="images/ecstasy.png" alt="ecstasy" /></p>
</section>
<section >
<h3>Unit Testing with xUnit.net</h3>
<aside class="notes">
This won't work well for scripts since xunit uses a separate test runner<br/>
that uses reflection to find tests using attributes.<br/>
</aside>
</section>
<section >
<p><img src="images/agony.png" alt="agony" /></p>
</section>
<section >
<h3>Unit Testing with NUnit</h3>
<aside class="notes">
See above.<br/>
</aside>
</section>
<section >
<p><img src="images/agony.png" alt="agony" /></p>
</section>
<section >
<h3>Unit Testing with Expecto</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#load</span> <span class="s">&quot;../.paket/load/net461/main.group.fsx&quot;</span>

<span class="k">open</span> <span class="i">Expecto</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
At last, a testing library that will run in a script!<br/>
First, create a new file, Tests.fsx, then open Expecto.<br/>
</aside>
</section>
<section >
<h3>Write a Test</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">addTest</span> <span class="o">=</span>
    <span class="i">testCase</span> <span class="s">&quot;An addition test&quot;</span> <span class="o">&lt;|</span> <span class="k">fun</span> () <span class="k">-&gt;</span>
        <span class="k">let</span> <span class="i">expected</span> <span class="o">=</span> <span class="n">4</span>
        <span class="i">Expect</span><span class="o">.</span><span class="i">equal</span> <span class="i">expected</span> (<span class="n">2</span><span class="o">+</span><span class="n">2</span>) <span class="s">&quot;2+2 = 4&quot;</span>

<span class="i">Tests</span><span class="o">.</span><span class="i">runTests</span> <span class="i">defaultConfig</span> <span class="i">addTest</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">[<span class="n">15</span><span class="o">:</span><span class="n">21</span><span class="o">:</span><span class="n">46</span> <span class="i">INF</span>] <span class="i">EXPECTO</span><span class="o">?</span> <span class="i">Running</span> <span class="i">tests</span><span class="o">..</span><span class="o">.</span> <span class="o">&lt;</span><span class="i">Expecto</span><span class="o">&gt;</span>
[<span class="n">15</span><span class="o">:</span><span class="n">21</span><span class="o">:</span><span class="n">46</span> <span class="i">INF</span>] <span class="i">EXPECTO!</span> <span class="n">1</span> <span class="i">tests</span> <span class="i">run</span> <span class="k">in</span> <span class="n">00</span><span class="o">:</span><span class="n">00</span><span class="o">:</span><span class="n">00.0297663</span> 

<span class="k">val</span> <span class="i">it</span> <span class="o">:</span> <span class="i">int</span> <span class="o">=</span> <span class="n">0</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
Let's start with a simple test. Well, that was easy. You define a testCase by<br/>
giving it a name and a function to run. You verify the expected result using<br/>
Expect.equal, which takes an expected value, the actual value, and a message<br/>
if the test case fails.<br/>
</aside>
</section>
<section >
<h3>Write a Failing Test</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">failTest</span> <span class="o">=</span>
    <span class="i">testCase</span> <span class="s">&quot;Failing test&quot;</span> <span class="o">&lt;|</span> <span class="k">fun</span> () <span class="k">-&gt;</span>
        <span class="i">Expect</span><span class="o">.</span><span class="i">equal</span> <span class="n">1</span> <span class="n">2</span> <span class="s">&quot;1 &lt;&gt; 2&quot;</span>

<span class="i">Tests</span><span class="o">.</span><span class="i">runTests</span> <span class="i">defaultConfig</span> <span class="i">failTest</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">[<span class="n">15</span><span class="o">:</span><span class="n">29</span><span class="o">:</span><span class="n">39</span> <span class="i">INF</span>] <span class="i">EXPECTO</span><span class="o">?</span> <span class="i">Running</span> <span class="i">tests</span><span class="o">..</span><span class="o">.</span> <span class="o">&lt;</span><span class="i">Expecto</span><span class="o">&gt;</span>
[<span class="n">15</span><span class="o">:</span><span class="n">29</span><span class="o">:</span><span class="n">39</span> <span class="i">ERR</span>] <span class="i">Failing</span> <span class="i">test</span> <span class="i">failed</span> <span class="k">in</span> <span class="n">00</span><span class="o">:</span><span class="n">00</span><span class="o">:</span><span class="n">00.0150000</span><span class="o">.</span>
<span class="n">1</span> <span class="o">&lt;&gt;</span> <span class="n">2.</span> <span class="i">Actual</span> <span class="i">value</span> <span class="i">was</span> <span class="n">1</span> <span class="i">but</span> <span class="i">had</span> <span class="i">expected</span> <span class="i">it</span> <span class="k">to</span> <span class="i">be</span> <span class="n">2.</span>
  <span class="i">s</span><span class="o">:</span>
 <span class="o">&lt;</span><span class="i">Expecto</span><span class="o">&gt;</span>
[<span class="n">15</span><span class="o">:</span><span class="n">29</span><span class="o">:</span><span class="n">39</span> <span class="i">INF</span>] <span class="i">EXPECTO!</span> <span class="n">1</span> <span class="i">tests</span> <span class="i">run</span> <span class="k">in</span> <span class="n">00</span><span class="o">:</span><span class="n">00</span><span class="o">:</span><span class="n">00.0270684</span> 

<span class="k">val</span> <span class="i">it</span> <span class="o">:</span> <span class="i">int</span> <span class="o">=</span> <span class="n">1</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
Write a failing test. Here you can see the test case name and message in the output,<br/>
making it quite easy to identify the culprit. <br/>
</aside>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">multTest</span> <span class="o">=</span>
    <span class="i">testCase</span> <span class="s">&quot;A multiplication test&quot;</span> <span class="o">&lt;|</span> <span class="k">fun</span> () <span class="k">-&gt;</span>
        <span class="k">let</span> <span class="i">expected</span> <span class="o">=</span> <span class="n">4</span>
        <span class="i">Expect</span><span class="o">.</span><span class="i">equal</span> <span class="i">expected</span> (<span class="n">2</span><span class="o">*</span><span class="n">2</span>) <span class="s">&quot;2*2 = 4&quot;</span>

<span class="k">let</span> <span class="i">intTests</span> <span class="o">=</span>
    <span class="i">testList</span> <span class="s">&quot;Integer math tests&quot;</span> [
        <span class="i">addTest</span>
        <span class="i">multTest</span>
    ]

<span class="i">Tests</span><span class="o">.</span><span class="i">runTests</span> <span class="i">defaultConfig</span> <span class="i">intTests</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">[<span class="n">15</span><span class="o">:</span><span class="n">27</span><span class="o">:</span><span class="n">37</span> <span class="i">INF</span>] <span class="i">EXPECTO</span><span class="o">?</span> <span class="i">Running</span> <span class="i">tests</span><span class="o">..</span><span class="o">.</span> <span class="o">&lt;</span><span class="i">Expecto</span><span class="o">&gt;</span>
[<span class="n">15</span><span class="o">:</span><span class="n">27</span><span class="o">:</span><span class="n">37</span> <span class="i">INF</span>] <span class="i">EXPECTO!</span> <span class="n">2</span> <span class="i">tests</span> <span class="i">run</span> <span class="k">in</span> <span class="n">00</span><span class="o">:</span><span class="n">00</span><span class="o">:</span><span class="n">00.0019015</span> 

<span class="k">val</span> <span class="i">it</span> <span class="o">:</span> <span class="i">int</span> <span class="o">=</span> <span class="n">0</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
In Expecto, tests are values, and you can group them and run them in their groups.<br/>
</aside>
</section>
<section >
<p><img src="images/ecstasy.png" alt="ecstasy" /></p>
</section>
<section >
<h3>FsCheck</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">config</span> <span class="o">=</span> { <span class="i">FsCheckConfig</span><span class="o">.</span><span class="i">defaultConfig</span> <span class="k">with</span> <span class="i">maxTest</span> <span class="o">=</span> <span class="n">10000</span> }

<span class="k">let</span> <span class="i">properties</span> <span class="o">=</span>
    <span class="i">testList</span> <span class="s">&quot;FsCheck samples&quot;</span> [
        <span class="i">testProperty</span> <span class="s">&quot;Addition is commutative&quot;</span> <span class="o">&lt;|</span> <span class="k">fun</span> <span class="i">a</span> <span class="i">b</span> <span class="k">-&gt;</span>
            <span class="i">a</span> <span class="o">+</span> <span class="i">b</span> <span class="o">=</span> <span class="i">b</span> <span class="o">+</span> <span class="i">a</span>

        <span class="i">testProperty</span> <span class="s">&quot;Reverse of reverse of a list is the original list&quot;</span> <span class="o">&lt;|</span>
            <span class="k">fun</span> (<span class="i">xs</span><span class="o">:</span><span class="i">list</span><span class="o">&lt;</span><span class="i">int</span><span class="o">&gt;</span>) <span class="k">-&gt;</span> <span class="i">List</span><span class="o">.</span><span class="i">rev</span> (<span class="i">List</span><span class="o">.</span><span class="i">rev</span> <span class="i">xs</span>) <span class="o">=</span> <span class="i">xs</span>

        <span class="c">// you can also override the FsCheck config</span>
        <span class="i">testPropertyWithConfig</span> <span class="i">config</span> <span class="s">&quot;Product is distributive over addition&quot;</span> <span class="o">&lt;|</span>
            <span class="k">fun</span> <span class="i">a</span> <span class="i">b</span> <span class="i">c</span> <span class="k">-&gt;</span> <span class="i">a</span> <span class="o">*</span> (<span class="i">b</span> <span class="o">+</span> <span class="i">c</span>) <span class="o">=</span> <span class="i">a</span> <span class="o">*</span> <span class="i">b</span> <span class="o">+</span> <span class="i">a</span> <span class="o">*</span> <span class="i">c</span>
    ]

<span class="i">Tests</span><span class="o">.</span><span class="i">runTests</span> <span class="i">defaultConfig</span> <span class="i">properties</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">[<span class="n">15</span><span class="o">:</span><span class="n">33</span><span class="o">:</span><span class="n">04</span> <span class="i">INF</span>] <span class="i">EXPECTO</span><span class="o">?</span> <span class="i">Running</span> <span class="i">tests</span><span class="o">..</span><span class="o">.</span> <span class="o">&lt;</span><span class="i">Expecto</span><span class="o">&gt;</span>
[<span class="n">15</span><span class="o">:</span><span class="n">33</span><span class="o">:</span><span class="n">04</span> <span class="i">INF</span>] <span class="i">EXPECTO!</span> <span class="n">3</span> <span class="i">tests</span> <span class="i">run</span> <span class="k">in</span> <span class="n">00</span><span class="o">:</span><span class="n">00</span><span class="o">:</span><span class="n">00.1008472</span> 
</code></pre></td>
</tr>
</table>
</section>
<section >
<h3>Group testLists</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">allTests</span> <span class="o">=</span>
    <span class="i">testList</span> <span class="s">&quot;all tests&quot;</span> [
        <span class="i">intTests</span>
        <span class="i">properties</span>
    ]

<span class="i">Tests</span><span class="o">.</span><span class="i">runTests</span> <span class="i">defaultConfig</span> <span class="i">allTests</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">[<span class="n">15</span><span class="o">:</span><span class="n">34</span><span class="o">:</span><span class="n">09</span> <span class="i">INF</span>] <span class="i">EXPECTO</span><span class="o">?</span> <span class="i">Running</span> <span class="i">tests</span><span class="o">..</span><span class="o">.</span> <span class="o">&lt;</span><span class="i">Expecto</span><span class="o">&gt;</span>
[<span class="n">15</span><span class="o">:</span><span class="n">34</span><span class="o">:</span><span class="n">09</span> <span class="i">INF</span>] <span class="i">EXPECTO!</span> <span class="n">5</span> <span class="i">tests</span> <span class="i">run</span> <span class="k">in</span> <span class="n">00</span><span class="o">:</span><span class="n">00</span><span class="o">:</span><span class="n">00.1008795</span> 
</code></pre></td>
</tr>
</table>
<aside class="notes">
Lastly, you can even group lists of tests and run them all together.<br/>
</aside>
</section>
<section >
<p><img src="images/ecstasy.png" alt="ecstasy" /></p>
</section>
<section >
<h3>Write some tests!</h3>
<aside class="notes">
Take a few minutes to write a few tests for the ETL functions we just wrote.<br/>
Given we used type providers, it may be difficult to think through what tests<br/>
to write. There's no correct answer. You may want to verify the CSV files were<br/>
written or that the transform function returned 1 or more results.<br/>
Don't forget to #load "App.fsx"!<br/>
</aside>
</section>
</section>
<section >
<section >
<h2>Visualizing Data Sets</h2>
<h3><a href="https://tahahachana.github.io/XPlot/">XPlot</a></h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span class="i">XPlot</span><span class="o">.</span><span class="i">GoogleCharts</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
One of the benefits of scripts is being able to print out charts.<br/>
XPlot provides several options, including GoogleCharts and Plotly.<br/>
We'll use the GoogleCharts library for our sample app.<br/>
</aside>
</section>
<section >
<p><img src="images/ecstasy.png" alt="ecstasy" /></p>
</section>
<section >
<h3>Show Locations</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">showMap</span> (<span class="i">data</span><span class="o">:</span><span class="i">LocationResult</span> <span class="i">list</span>) <span class="o">=</span>
    <span class="i">data</span>
    <span class="o">|&gt;</span> <span class="i">List</span><span class="o">.</span><span class="i">map</span> (<span class="k">fun</span> <span class="i">x</span> <span class="k">-&gt;</span> <span class="i">x</span><span class="o">.</span><span class="i">Latitude</span>, <span class="i">x</span><span class="o">.</span><span class="i">Longitude</span>, <span class="i">x</span><span class="o">.</span><span class="i">DisplayName</span>)
    <span class="o">|&gt;</span> <span class="i">Chart</span><span class="o">.</span><span class="i">Map</span>
    <span class="o">|&gt;</span> <span class="i">Chart</span><span class="o">.</span><span class="i">WithOptions</span> (<span class="i">Options</span>(<span class="i">showTip</span> <span class="o">=</span> <span class="k">true</span>))
    <span class="o">|&gt;</span> <span class="i">Chart</span><span class="o">.</span><span class="i">WithHeight</span> <span class="n">420</span>
    <span class="o">|&gt;</span> <span class="i">Chart</span><span class="o">.</span><span class="i">Show</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
Call showMap.<br/>
Since we are retrieving one or more location results, let's show them on a map.<br/>
It's easier for the human mind to comprehend a visualization rather than a table<br/>
of data, so rendering a chart can quickly help you zero in on the objective<br/>
of the search.<br/>
Using data you've retrieved from the transform function, call the showMap function.<br/>
What do you see? <br/>
</aside>
</section>
<section >
<h4>Energy Use per Country</h4>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">showEnergyUse</span> (<span class="i">data</span><span class="o">:</span><span class="i">LocationResult</span> <span class="i">list</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="i">labels</span>, <span class="i">plots</span> <span class="o">=</span>
        <span class="i">data</span>
        <span class="o">|&gt;</span> <span class="i">List</span><span class="o">.</span><span class="i">choose</span> (<span class="k">fun</span> <span class="i">x</span> <span class="k">-&gt;</span>
            <span class="k">match</span> <span class="i">x</span><span class="o">.</span><span class="i">EnergyUse</span> <span class="k">with</span>
            | <span class="i">Some</span> <span class="i">energyUse</span> <span class="k">-&gt;</span> <span class="i">Some</span>(<span class="i">x</span><span class="o">.</span><span class="i">Country</span>, <span class="i">energyUse</span>)
            | <span class="i">None</span> <span class="k">-&gt;</span> <span class="i">None</span>)
        <span class="o">|&gt;</span> <span class="i">List</span><span class="o">.</span><span class="i">distinctBy</span> <span class="i">fst</span>
        <span class="o">|&gt;</span> <span class="i">List</span><span class="o">.</span><span class="i">map</span> (<span class="k">fun</span> (<span class="i">country</span>, <span class="i">energyUse</span>) <span class="k">-&gt;</span>
            <span class="i">country</span>, [<span class="k">for</span> <span class="i">y</span> <span class="k">in</span> <span class="n">1960..</span><span class="n">2010</span> <span class="k">-&gt;</span> <span class="i">string</span> <span class="i">y</span>, <span class="i">energyUse</span><span class="o">.</span>[<span class="i">y</span>]])
        <span class="o">|&gt;</span> <span class="i">List</span><span class="o">.</span><span class="i">unzip</span>
    <span class="i">plots</span>
    <span class="o">|&gt;</span> <span class="i">Chart</span><span class="o">.</span><span class="i">Line</span>
    <span class="o">|&gt;</span> <span class="i">Chart</span><span class="o">.</span><span class="i">WithOptions</span> (<span class="i">Options</span>(<span class="i">title</span> <span class="o">=</span> <span class="s">&quot;Energy use per capita&quot;</span>))
    <span class="o">|&gt;</span> <span class="i">Chart</span><span class="o">.</span><span class="i">WithLabels</span> <span class="i">labels</span>
    <span class="o">|&gt;</span> <span class="i">Chart</span><span class="o">.</span><span class="i">Show</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
Next, let's write a function that will take the energy use data we<br/>
retrieved and render it in a line graph.<br/>
</aside>
</section>
<section >
<aside class="notes">
Custom Printers<br/>
</aside>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">fsi</span><span class="o">.</span><span class="i">AddPrinter</span>(<span class="k">fun</span> (<span class="i">chart</span><span class="o">:</span><span class="i">XPlot</span><span class="o">.</span><span class="i">GoogleCharts</span><span class="o">.</span><span class="i">GoogleChart</span>) <span class="k">-&gt;</span>
   <span class="i">chart</span> <span class="o">|&gt;</span> <span class="i">Chart</span><span class="o">.</span><span class="i">Show</span>
   <span class="s">&quot;Google Chart&quot;</span>)
</code></pre></td>
</tr>
</table>
<aside class="notes">
F# Interactive allows you to define custom printers. These are most<br/>
common in validating data sets and UIs. We can now remove the calls<br/>
to Chart.Show above, so long as the chart is the last thing returned.<br/>
</aside>
</section>
<section >
<h3>Add show* to <code>run</code></h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">run</span> <span class="i">city</span> <span class="o">=</span>
    <span class="k">let</span> <span class="i">data</span> <span class="o">=</span> (<span class="i">extract</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="i">transform</span>) <span class="i">city</span>
    <span class="i">load</span> <span class="i">data</span>
    <span class="i">showMap</span> <span class="i">data</span>
    <span class="i">showEnergyUse</span> <span class="i">data</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
Let's add this to our run function so that we plot out the charts whenever<br/>
the data set is retrieved. Make sure you restore the |> Chart.Show in the<br/>
show functions or they won't display.<br/>
This will act as a visual cue that we have the correct data set.<br/>
Feel free to add in any tests you created, as well.<br/>
Try entering different locations into your interactive session and report<br/>
on what you are seeing. "San Francisco" is quite interesting.<br/>
</aside>
</section>
</section>
<section >
<section >
<h2>Accessing Command Line Parameters</h2>
<aside class="notes">
We have not yet left scripts, yet we are also not done with our possibilities<br/>
for practically leveraging scripts. So far we have been running whatever is<br/>
defined in the script file. What if we want to run the script but parameterize<br/>
it from the command line?<br/>
</aside>
</section>
<section >
<h3>PowerShell Wrappers</h3>
<aside class="notes">
My company currently has several F# scripts that are wrapped by PowerShell.<br/>
The scripts work great, and we used PowerShell to provide better tab-completion.<br/>
The PowerShell works fine, but I wondered whether F# could do it all.<br/>
</aside>
</section>
<section >
<h3>Argu</h3>
<p><img src="images/argu-logo.png" alt="Argu" /></p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span class="i">Argu</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
Argu is a terrific library that provides features for parsing command line arguments,<br/>
defining command line arguments, defining subcommands, and printing CLI help.<br/>
Arguu can also be used from a script file!<br/>
</aside>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span class="i">Arguments</span> <span class="o">=</span>
    | [&lt;<span class="i">Mandatory</span>&gt;] <span class="i">City</span> <span class="k">of</span> <span class="i">string</span>
    <span class="k">with</span>
    <span class="k">interface</span> <span class="i">IArgParserTemplate</span> <span class="k">with</span>
        <span class="k">member</span> <span class="i">this</span><span class="o">.</span><span class="i">Usage</span> <span class="o">=</span>
            <span class="k">match</span> <span class="i">this</span> <span class="k">with</span>
            | <span class="i">City</span> _ <span class="k">-&gt;</span> <span class="s">&quot;Enter a location name&quot;</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
Let's define the expected arguments. We expect a City that is of type string.<br/>
The City parameter is mandatory. By default, this translates to `--city` on the CLI.<br/>
The IArgParserTemplate is a required interface for working with Argu and provides<br/>
the content displayed in the --help.<br/>
</aside>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">runCLI</span> <span class="i">args</span> <span class="o">=</span>
    <span class="c">//let args = [|&quot;Map.fsx&quot;;&quot;--city&quot;;&quot;Adelaide&quot;|].[1..]</span>
    <span class="k">let</span> <span class="i">argParser</span> <span class="o">=</span> <span class="i">ArgumentParser</span><span class="o">.</span><span class="i">Create</span><span class="o">&lt;</span><span class="i">Arguments</span><span class="o">&gt;</span>(<span class="i">errorHandler</span> <span class="o">=</span> <span class="i">ProcessExiter</span>())
    <span class="k">let</span> <span class="i">argResults</span> <span class="o">=</span> <span class="i">argParser</span><span class="o">.</span><span class="i">Parse</span>(<span class="i">args</span>)
    <span class="k">let</span> <span class="i">city</span> <span class="o">=</span> <span class="i">argResults</span><span class="o">.</span><span class="i">GetResult</span> &lt;@ <span class="i">City</span> @&gt;
    <span class="i">run</span> <span class="i">city</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
Next, let's use the Argu parser to extract values.<br/>
I'm defining the errorHandler as a ProcessHandler to shut down<br/>
any environments thtat break for some reason.<br/>
Ultimately, we want to retrieve the City value and pass it along<br/>
to run to execute our ETL and visualization code.<br/>
That is all well and good, but how do you retrieve the command line<br/>
arguments initially?<br/>
</aside>
</section>
<section >
<h3>fsi.CommandLineArgs</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">runCLI</span> <span class="i">fsi</span><span class="o">.</span><span class="i">CommandLineArgs</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="o">$</span> <span class="i">fsharpi</span> <span class="i">exercises</span><span class="o">/</span><span class="i">App</span><span class="o">.</span><span class="i">fsx</span> <span class="o">--</span><span class="i">city</span> <span class="o">&#39;</span><span class="i">San</span> <span class="i">Francisco&#39;</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
You can access the command line args in a script using fsi.CommandLineArgs.<br/>
Try running our program above using runCLI fsi.CommandLineArgs<br/>
What do you get?<br/>
</aside>
</section>
<section >
<p><img src="images/agony.png" alt="agony" /></p>
</section>
<section >
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">ERROR</span><span class="o">:</span> <span class="i">unrecognized</span> <span class="i">argument</span><span class="o">:</span> <span class="o">&#39;</span><span class="o">.</span>
<span class="i">USAGE</span><span class="o">:</span> <span class="i">fsiAnyCPU</span><span class="o">.</span><span class="i">exe</span> [<span class="o">--</span><span class="i">help</span>] <span class="o">--</span><span class="i">city</span> <span class="o">&lt;</span><span class="i">string</span><span class="o">&gt;</span>

<span class="i">OPTIONS</span><span class="o">:</span>

    <span class="o">--</span><span class="i">city</span> <span class="o">&lt;</span><span class="i">string</span><span class="o">&gt;</span>       <span class="i">Enter</span> <span class="i">a</span> <span class="i">location</span> <span class="i">name</span>
    <span class="o">--</span><span class="i">help</span>                <span class="i">display</span> <span class="i">this</span> <span class="i">list</span> <span class="k">of</span> <span class="i">options</span><span class="o">.</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
When you run your script like an application, the script file becomes<br/>
one of the arguments. So you need to strip this argument off the top.<br/>
</aside>
</section>
<section >
<h3>fsi.CommandLineArgs</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">args</span> <span class="o">=</span> <span class="i">fsi</span><span class="o">.</span><span class="i">CommandLineArgs</span><span class="o">.</span>[<span class="n">1..</span>]
<span class="i">runCLI</span> <span class="i">args</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
The fsi object has several useful properties, one of which is<br/>
`fsi.CommandLinArgs`. This can be used to retrieve the CLI args<br/>
for a script. However, make sure to trim off the first index,<br/>
as that should include the name of the file read<br/>
</aside>
</section>
<section >
<h3>Run App.fsx with --city</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="o">$</span> <span class="i">fsharpi</span> <span class="i">exercises</span><span class="o">/</span><span class="i">App</span><span class="o">.</span><span class="i">fsx</span> <span class="o">--</span><span class="i">city</span> <span class="i">Houston</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
Run your script now? What do you see? You should see two graphs opened in<br/>
a web browser. You should also still see your generated CSV files.<br/>
</aside>
</section>
<section >
<p><img src="images/ecstasy.png" alt="ecstasy" /></p>
</section>
<section >
<h3>Paket.fsx</h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#load</span> <span class="s">&quot;../exercises/Paket.fsx&quot;</span>
<span class="i">Paket</span><span class="o">.</span><span class="i">download</span>()
<span class="i">Paket</span><span class="o">.</span><span class="i">restore</span>()
<span class="i">Paket</span><span class="o">.</span><span class="i">generateLoadScripts</span> <span class="s">&quot;net461&quot;</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
Take a look at exercises/Paket.fsx. Note that this exercises/ folder<br/>
has no special requirements except to verify that the script is valid. <br/>
The above commands wrap the paket.exe command line executable.<br/>
If we enter this toward the top of the script file, we will be able<br/>
to effectively deploy and run everything necessary to run the script.<br/>
<blockquote>
<p>Take this opportunity to re-run the entire script.<br/>
If you have correctly set your default paths, you should do so.<br/>
You  don't remember ever haing to figur.<br/>
</aside></p>
</blockquote>
</section>
<section >
<h3></h3>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">fsharpi</span> <span class="o">.</span><span class="o">/</span><span class="i">exercises</span><span class="o">/</span><span class="i">App</span><span class="o">.</span><span class="i">fsx</span> <span class="o">--</span><span class="i">client</span> <span class="i">Adelaide</span>
</code></pre></td>
</tr>
</table>
<aside class="notes">
You can now specify the city from the command line. This allows us to<br/>
pull off program data and turn it into something interesting.<br/>
</aside>
'
</section>
</section>
<section >
<section >
<h2>DEMO</h2>
<h3>Using Scripts in a Project</h3>
</section>
<section >
<h3>Compiled or Interactive</h3>
<h4>Why choose?</h4>
<aside class="notes">
Trying to run code in F# interactive that has been written<br/>
as a compiled library or executable can sometimes be tricky.<br/>
We'll look at techniques to make this less difficult.<br/>
</aside>
</section>
</section>
<section >
<h2>DEMO</h2>
<h3>Debugging Scripts</h3>
</section>
<section >
<h2>DEMO</h2>
<h3>Build and Deploy Scripting with FAKE</h3>
</section>
<section >
<h1>Review</h1>
</section>
<section >
<h2>Deployment Options</h2>
<aside class="notes">
As noted earlier, we are not able to go into the details of each option, <br/>
but I want you at least be aware of some of the options available.<br/>
As an example, this slide deck is built using a FAKE script and FsReveal,<br/>
which uses FSharp.Formatting.<br/>
</aside>
<p><a href="http://fsprojects.github.io/FsReveal/"><img alt="FsReveal" src="images/logo.png" class="logo" /></a></p>
<p><a href="https://fake.build/"><img alt="FAKE" src="images/fake.png" class="logo" /></a></p>
<p><a href="http://bayardrock.github.io/IfSharp/"><img alt="Jupyter Notebooks" src="images/jupyter.png" class="logo" /></a></p>
<p><a href="https://blogs.msdn.microsoft.com/visualstudio/2016/12/05/azure-notebooks-now-support-f/"><img alt="Azure Notebooks" src="images/azure-notebooks.jpg" class="logo" /></a></p>
<p><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-reference-fsharp"><img alt="Azure Functions" src="images/Azure-Functions-Logo.png" class="logo" /></a></p>
<p><a href="https://github.com/FSharpBristol/FSharp-Template-for-Aws-Lambda"><img alt="AWS Lambda" src="images/aws-lambda.png" class="logo" /></a></p>
</section>
<section >
<h1>Summary</h1>
<img alt="ecstasy" src="images/ecstasy.png" class="image-row" />
<img alt="agony" src="images/agony.png" class="image-row" />
<aside class="notes">
<br/>
</aside>
</section>


        </div>
    </div>
    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>
    <script>
        // Add the nohighlight class and data-noescape attribute to code elements that have already been formatted by FSharp.Formatting
        $('pre.highlighted code').addClass('nohighlight').attr('data-noescape', '');

        // Full list of configuration options available here:
        // https://github.com/hakimel/reveal.js#configuration
        Reveal.initialize({
            controls: true,
            progress: true,
            history: true,
            center: true,

            transition: 'default', // default/cube/page/concave/zoom/linear/fade/none

            // Parallax scrolling
            // parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
            // parallaxBackgroundSize: '2100px 900px',

            // Optional libraries used to extend on reveal.js
            dependencies: [
                { src: 'lib/js/classList.js', condition: function () { return !document.body.classList; } },
                { src: 'plugin/markdown/marked.js', condition: function () { return !!document.querySelector('[data-markdown]'); } },
                { src: 'plugin/markdown/markdown.js', condition: function () { return !!document.querySelector('[data-markdown]'); } },
                { src: 'plugin/highlight/highlight.js', async: true, callback: function () { hljs.initHighlightingOnLoad(); } },
                { src: 'plugin/zoom-js/zoom.js', async: true, condition: function () { return !!document.body.classList; } },
                { src: 'plugin/notes/notes.js', async: true, condition: function () { return !!document.body.classList; } }
            ]
        });

    </script>
</body>
</html>

